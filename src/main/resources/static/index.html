<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Касса</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
<div class="container">
    <h1 class="text-center mt-4">Выберите роль</h1>
    <div class="text-center">
        <button class="btn btn-primary" onclick="selectRole('client')">Я клиент</button>
        <button class="btn btn-secondary" onclick="selectRole('cashier')">Я кассир</button>
    </div>
    <div id="role-selection" class="d-none">
        <h2 class="text-center mt-4">Выберите кассу</h2>
        <select id="kassaSelect" class="form-control" onchange="selectKassa()">
            <option value="">Выберите кассу</option>
            <option value="1">Касса 1</option>
            <option value="2">Касса 2</option>
            <option value="3">Касса 3</option>
            <option value="4">Касса 4</option>
        </select>
        <div id="actionButtons" class="mt-4 d-none">
            <button class="btn btn-success" onclick="sendTransfer()">Отправить перевод</button>
            <button class="btn btn-info" onclick="receiveTransfer()">Получить перевод</button>
        </div>
    </div>

    <!-- Form for sending transfer -->
    <div id="sendTransferForm" class="d-none">
        <h2 class="text-center mt-4">Отправить перевод</h2>
        <form id="transferForm">
            <div class="form-group">
                <label for="senderNumber">Номер отправителя</label>
                <input type="text" id="senderNumber" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="recipientNumber">Номер получателя</label>
                <input type="text" id="recipientNumber" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="senderName">ФИО отправителя</label>
                <input type="text" id="senderName" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="recipientName">ФИО получателя</label>
                <input type="text" id="recipientName" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="amount">Сумма</label>
                <input type="number" id="amount" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="description">Описание</label>
                <textarea id="description" class="form-control" required></textarea>
            </div>
            <button type="button" class="btn btn-primary" onclick="submitTransfer()">Отправить</button>
            <button type="button" class="btn btn-secondary" onclick="goHome()">Домой</button>
        </form>
        <div id="transactionCode" class="mt-3"></div>
    </div>

    <!-- Form for receiving transfer -->
    <div id="receiveTransferForm" class="d-none">
        <h2 class="text-center mt-4">Получить перевод</h2>
        <form id="receiveForm">
            <div class="form-group">
                <label for="transactionCodeInput">Код транзакции</label>
                <input type="text" id="transactionCodeInput" class="form-control" required>
            </div>
            <button type="button" class="btn btn-primary" onclick="submitReceive()">Получить</button>
            <button type="button" class="btn btn-secondary" onclick="goHome()">Домой</button>
        </form>
        <div id="receiveResult" class="mt-3"></div>
    </div>
</div>

<script>
    let selectedKassaId = null;

    function selectRole(role) {
        document.getElementById('role-selection').classList.remove('d-none');
        document.getElementById('actionButtons').classList.remove('d-none');
    }

    function selectKassa() {
        selectedKassaId = document.getElementById('kassaSelect').value;
        if (selectedKassaId) {
            document.getElementById('sendTransferForm').classList.remove('d-none');
            document.getElementById('receiveTransferForm').classList.remove('d-none');
        }
    }

    function sendTransfer() {
        document.getElementById('sendTransferForm').classList.remove('d-none');
        document.getElementById('receiveTransferForm').classList.add('d-none');
    }

    function receiveTransfer() {
        document.getElementById('receiveTransferForm').classList.remove('d-none');
        document.getElementById('sendTransferForm').classList.add('d-none');
    }

    function goHome() {
        document.getElementById('role-selection').classList.add('d-none');
        document.getElementById('sendTransferForm').classList.add('d-none');
        document.getElementById('receiveTransferForm').classList.add('d-none');
        document.getElementById('kassaSelect').selectedIndex = 0;
    }

    function submitTransfer() {
        const senderNumber = document.getElementById('senderNumber').value;
        const recipientNumber = document.getElementById('recipientNumber').value;
        const senderName = document.getElementById('senderName').value;
        const recipientName = document.getElementById('recipientName').value;
        const amount = document.getElementById('amount').value;
        const description = document.getElementById('description').value;

        const transferData = {
            senderNumber,
            recipientNumber,
            senderName,
            recipientName,
            amount,
            description,
            kassaId: selectedKassaId
        };

        fetch('/api/transactions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(transferData)
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === "TRANSACTION_SUCCESSFUL") {
                    document.getElementById('transactionCode').innerText = `Код транзакции: ${data.transactionCode}`;
                }
            });
    }

    function submitReceive() {
        const transactionCode = document.getElementById('transactionCodeInput').value;

        fetch(`/api/transactions/${transactionCode}`, {
            method: 'GET',
        })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('receiveResult');
                if (data.status === "PAYMENT_SUCCESSFUL") {
                    resultDiv.innerText = 'Перевод успешно получен.';
                } else if (data.status === "TRANSACTION_NOT_FOUNT") {
                    resultDiv.innerText = 'Перевод не найден.';
                } else {
                    resultDiv.innerText = 'Перевод закрыт.';
                }
            });
    }
</script>
</body>
</html>
