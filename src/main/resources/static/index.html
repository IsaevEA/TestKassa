<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kassa Transaction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- Роль -->
<div id="roleSelection">
    <h1>Выберите роль</h1>
    <button class="btn btn-primary" onclick="selectRole('client')">Я клиент</button>
    <button class="btn btn-secondary" onclick="selectRole('cashier')">Я сотрудник банка</button>
</div>

<!-- Выбор кассы -->
<div id="kassaSelection" style="display: none;">
    <h1>Выберите кассу</h1>
    <button class="btn btn-primary" onclick="selectKassa(1)">Касса 1</button>
    <button class="btn btn-primary" onclick="selectKassa(2)">Касса 2</button>
    <button class="btn btn-primary" onclick="selectKassa(3)">Касса 3</button>
    <button class="btn btn-primary" onclick="selectKassa(4)">Касса 4</button>
</div>

<!-- Выбор действия -->
<div id="actionSelection" style="display: none;">
    <h1>Выберите действие</h1>
    <button class="btn btn-success" onclick="startTransaction('send')">Отправить перевод</button>
    <button class="btn btn-info" onclick="startTransaction('receive')">Получить перевод</button>
</div>

<!-- Отправить перевод -->
<div id="sendTransaction" style="display: none;">
    <h1>Отправить перевод</h1>
    <form id="sendForm">
        <div class="mb-3">
            <label for="senderPhone" class="form-label">Номер отправителя</label>
            <input type="text" class="form-control" id="senderPhone" required>
        </div>
        <div class="mb-3">
            <label for="receiverPhone" class="form-label">Номер получателя</label>
            <input type="text" class="form-control" id="receiverPhone" required>
        </div>
        <div class="mb-3">
            <label for="senderName" class="form-label">ФИО отправителя</label>
            <input type="text" class="form-control" id="senderName" required>
        </div>
        <div class="mb-3">
            <label for="receiverName" class="form-label">ФИО получателя</label>
            <input type="text" class="form-control" id="receiverName" required>
        </div>
        <div class="mb-3">
            <label for="amount" class="form-label">Сумма перевода</label>
            <input type="number" class="form-control" id="amount" required>
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Описание</label>
            <textarea class="form-control" id="description" rows="3"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Отправить перевод</button>
    </form>
</div>

<!-- Получить перевод -->
<div id="receiveTransaction" style="display: none;">
    <h1>Получить перевод</h1>
    <form id="receiveForm">
        <div class="mb-3">
            <label for="transactionCode" class="form-label">Код транзакции</label>
            <input type="text" class="form-control" id="transactionCode" required>
        </div>
        <button type="submit" class="btn btn-primary">Получить перевод</button>
    </form>
</div>

<!-- Скрипты -->
<script>
    let selectedKassa = null;

    function selectRole(role) {
        document.getElementById('roleSelection').style.display = 'none';
        if (role === 'client') {
            document.getElementById('kassaSelection').style.display = 'block';
        } else {
            // Логика для сотрудника банка
        }
    }

    function selectKassa(kassaId) {
        selectedKassa = kassaId;
        document.getElementById('kassaSelection').style.display = 'none';
        document.getElementById('actionSelection').style.display = 'block';
    }

    function startTransaction(action) {
        document.getElementById('actionSelection').style.display = 'none';
        if (action === 'send') {
            document.getElementById('sendTransaction').style.display = 'block';
        } else if (action === 'receive') {
            document.getElementById('receiveTransaction').style.display = 'block';
        }
    }

    document.getElementById('sendForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const senderPhone = document.getElementById('senderPhone').value;
        const receiverPhone = document.getElementById('receiverPhone').value;
        const senderName = document.getElementById('senderName').value;
        const receiverName = document.getElementById('receiverName').value;
        const amount = document.getElementById('amount').value;
        const description = document.getElementById('description').value;

        fetch('http://localhost:8080/transactions/send', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                senderPhone,
                receiverPhone,
                senderName,
                receiverName,
                amount,
                description,
                kassaId: selectedKassa
            })
        })
            .then(response => response.json())
            .then(data => {
                alert('Код транзакции: ' + data.transactionCode);
                window.location.href = '/';
            })
            .catch(error => {
                console.error('Error:', error);
            });
    });

    document.getElementById('receiveForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const transactionCode = document.getElementById('transactionCode').value;

        fetch('http://localhost:8080/transactions/receive', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ transactionCode })
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'PAYMENT_SUCCESSFUL') {
                    alert('Перевод успешно получен.');
                } else {
                    alert('Перевод не найден.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    });
</script>

</body>
</html>
